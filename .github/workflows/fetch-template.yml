name: Update Qt .ts files

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
  update-translations:
    runs-on: ubuntu-24.04

    steps:
      - name: Checkout repository
        uses: actions/checkout@main

      - name: Download template artifact
        uses: actions/download-artifact@main
        with:
          name: RPCS3_Translation_Template
          path: template/
          repository: RPCS3/rpcs3
          github-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract template ZIP
        run: |
          unzip template/RPCS3_Translation_Template.zip -d template/
          rm template/RPCS3_Translation_Template.zip

      - name: Install Qt Tools
        run: |
          sudo apt update
          sudo apt install -y qt6-l10n-tools

      - name: Update translations
        run: |
          for ts_file in translations/*.ts; do
            lupdate template/rpcs3_template.ts -no-obsolete -ts "$ts_file"
          done

      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add template/rpcs3_template.ts translations/
          git commit -m "Update translations based on latest template"
          git push